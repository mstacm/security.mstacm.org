<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="ACM Security Website Events Page">
    <meta name="keywords" content="ACM Security, Missouri S&T">
    <meta name="author" content="Charles Rawlins">

    <title>Payment | ACM Security</title>

    <!-- CSS Files -->
    <link href="/css/mdb-free.css" rel="stylesheet">
    <link href="/css/particles.css" media="screen" rel="stylesheet">
    <!-- Font Awesome for prettier icons -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
        /* Blue outline on focus */
        .StripeElement--focus {
            border-color: #80BDFF;
            outline: 0;
            box-shadow: 0 0 0 .2rem rgba(0, 123, 255, .25);
            transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        }

        html, body {
            height: 100%;
        }

    </style>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        $(document).ready(async function () {

            // Create a Stripe client
            const stripePK = await fetch("/api/merch/stripe-pk");
            const stripe = Stripe(stripePK);

            // Create an instance of Elements
            const elements = stripe.elements();

            // Try to match bootstrap 4 styling
            const style = {
                base: {
                    'lineHeight': '1.35',
                    'fontSize': '1.11rem',
                    'color': '#495057',
                    'fontFamily': 'apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif'
                }
            };

            // Card number
            const card = elements.create('cardNumber', {
                'placeholder': '4242 4242 4242 4242',
                'style': style
            });
            card.mount('#card-number');

            // CVC
            const cvc = elements.create('cardCvc', {
                'placeholder': '111',
                'style': style
            });
            cvc.mount('#card-cvc');

            // Card expiry
            const exp = elements.create('cardExpiry', {
                'placeholder': '01/01',
                'style': style
            });
            exp.mount('#card-exp');

            // Submit
            $('#payment-submit').on('click', function (e) {
                e.preventDefault();
                $('#payment-submit').prop('disabled',true);
                $('#payment-submit').text("Please wait...")
                const cardData = {
                    'name': $('#name').val()
                };
                stripe.createToken(card, cardData).then(function (result) {
                    if (result.error && result.error.message) {
                        alert(result.error.message);
                    } else {
                        // Pass token to our server to finalize payment
                        makeTransaction(result.token.id);
                    }
                });
            });

        });
    </script>
    <script src="clientPay.js"></script>
</head>

<body style="padding-top: 16px; padding-bottom: 16px;" class="jumbotron-main">

<!-- Setup Particles and page background -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <!--    <div id="card-errors" role="alert"></div>-->
    <div id="particles-js">
        <canvas class="particles-js-canvas-el" width="1409" height="319" style="width: 100%; height: 100%;"></canvas>
    </div>
    <script src="/globalScripts/particles.js" defer></script>

    <div class="row justify-content-center align-items-center" style="height:100%">
        <div class="card bg-dark text-white" style="width: 25rem;">
            <div class="card-header" id="userFormTitle">
                Merch Purchase <b>(Pick up only!)</b>
            </div>

            <div class="card-body">
                <div id="userForms">
                    <p>
                        <label>Name</label> <br>
                        <input class="w-100 input-group-lg" id='customerName' type="name" placeholder="Joe Miner"  style="border-radius: 5px">
                    </p>
                    <p>
                        <label>Email</label> <br>
                        <input class="w-100 input-group-lg" id='merchEmail' type="email" placeholder="youremail@here.com"  style="border-radius: 5px">
                    </p>
                    <p>
                        <label>Discount Code</label> <br>
                        <input class="w-100 input-group-lg" id='merchDiscount' placeholder="----" style="border-radius: 5px">
                    <!-- </p>
                    Enter your order:
                    <hr class="primary-color">
                    <p>
                        <label># of bundles</label> <br> -->
                        <input class="w-100" type="hidden" id='numBundles' placeholder="1" style="border-radius: 5px" MIN="1" MAX="10" STEP="1">
                    <!-- </p> -->
                    <p class="mb-n2 pb-n2">
                        <label>Shirt size</label>
                    <div class="row justify-content-center">

                    <div class="form-check m-2">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="smallRadio" checked>
                        <label class="form-check-label" for="smallRadio">
                            Small
                        </label>
                    </div>
                    <div class="form-check m-2">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="medRadio">
                        <label class="form-check-label" for="medRadio">
                            Medium
                        </label>
                    </div>
                    <div class="form-check m-2">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="largeRadio">
                        <label class="form-check-label" for="largeRadio">
                            Large
                        </label>
                    </div>
                    <div class="form-check m-2">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="xlRadio">
                        <label class="form-check-label" for="xlRadio">
                            XL
                        </label>
                    </div>
                </div>
                    </p>
                </div>

            </div>

        </div>

        <div class="card" style="width: 25rem">
            <div class="card-header">
                <div class="row justify-content-between">
                    <div class="col">
                        <h3 id="paymentCharge">
                            Total Price: $0 <!--                    Insert price from js here-->
                        </h3>
                    </div>
                    <div class="col-2">
                        <img src="stripe.png" style="height: 25px;float: right">
                    </div>
                </div>

            </div>
            <div class="card-body">
                <form id="payment-form">
                    <label for="name">Name on Card</label>
                    <div class="input-group mb-2">
                        <input type="text" class="form-control" id="name" placeholder="Joe Miner">
                    </div>
                    <label for="card-number">Credit Card Number</label>
                    <img src="acceptedCards/visa.png" style="height: 30px">
                    <img src="acceptedCards/mastercard.png" style="height: 30px">
                    <img src="acceptedCards/discover.png" style="height: 30px">
                    <img src="acceptedCards/amexpress.png" style="height: 30px">
                    <div class="input-group mb-2">
                        <span id="card-number" class="form-control">
                            <!-- Stripe Card Element -->
                        </span>
                    </div>
                    <label for="card-cvc">CVC Number</label>
                    <div class="input-group mb-2">
                        <span id="card-cvc" class="form-control">
                            <!-- Stripe CVC Element -->
                        </span>
                    </div>
                    <label for="card-exp">Expiration</label>
                    <div class="input-group mb-2">
                        <span id="card-exp" class="form-control">
                            <!-- Stripe Card Expiry Element -->
                        </span>
                    </div>
                    <div class="row justify-content-center align-middle">
                        <button id="payment-submit" class="btn btn-primary mt-1">Submit Payment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!--    ________________________________________   -->
    <!--  < With stripe.js, your payment info won't >  -->
    <!--  <               touch our server!         >  -->
    <!--    ----------------------------------------   -->
    <!--      \  ^__^                                  -->
    <!--       \ (oo)\_______                          -->
    <!--         (__)\        )\/\                     -->
    <!--              ||----ww|                        -->
    <!--              ||     ||                        -->

</body>
</html>
